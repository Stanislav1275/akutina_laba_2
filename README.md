# 1. Введение

Задача автоматизированной детекции людей на тепловизионных снимках актуальна в области охраны периметров, поисково-спасательных операций, противопожарной безопасности и военного применения. В отличие от RGB-камер, тепловизоры фиксируют инфракрасное излучение, что позволяет обнаруживать объекты в условиях плохой видимости, темноты, задымления или маскировки. Классические методы обработки термограмм включают пороговую сегментацию, морфологические операции и анализ температурных контуров. 

Цель проекта — разработать практическую систему пакетной обработки тепловизионных изображений, которая:

- принимает массив термоснимков (серия кадров с одной или нескольких камер);
- автоматически выявляет присутствие людей на каждом изображении;
- возвращает отфильтрованный набор снимков с визуальным выделением обнаруженных фигур (bounding boxes, контуры или цветовое маркирование);
- использует предобученные или дообученные модели детекции для минимизации трудозатрат на разметку.

# 2. Функциональные требования

**Входные данные:** набор тепловизионных изображений в форматах TIFF, PNG, JPEG, WEBP. 
**Детекция людей:**
- выделение областей с характерной термосигнатурой человеческого тела;
- классификация обнаруженных объектов с оценкой уверенности;
**Формирование результатов:**
- сохранение только тех изображений, где детектированы люди;
- визуализация результатов (наложение рамок, масок или цветовой подсветки);
- экспорт метаданных (координаты обнаружений, уровень уверенности, имя файла).
- Отказоустойчивость: при частичной обработке файлов(n/m), отдавать часть с успешной обработкой, вместо цельной ошибки.

**Веб-интерфейс:**
- загрузка пакета изображений (drag-and-drop или архив);
- отображение прогресса обработки;
- просмотр результатов с возможностью фильтрации по уровню уверенности;
- скачивание обработанных снимков и отчёта.

# 3. Нефункциональные требования

### 1. Производительность

Система должна обрабатывать пакеты изображений различного размера.

Основные показатели:
- обработка одного изображения разрешением 640×480 - не более 300 мс на CPU;
- загрузка и парсинг архива из 500 изображений — не более 1 часа, на основании оффлайн работы;
- формирование итогового отчёта с визуализацией — не более 10 секунд после завершения детекции.

Система должна поддерживать последовательную обработку нескольких пакетов без перезапуска.

---

### 2. Масштабируемость

Архитектура системы позволяет:
- добавление новых пакетов изображений в очередь без остановки процесса;
- обработку изображений различного разрешения и битовой глубины без изменения кода;
- распараллеливание обработки на несколько ядер CPU или перенос на GPU-сервер.

Производительность должна деградировать линейно при увеличении объёма данных.

---

### 3. Эргономичность

Интерфейс приложения должен быть интуитивно понятным.

Требования:
- простая загрузка файлов (перетаскивание архива или выбор через диалог);
- визуальная индикация процесса обработки (прогресс-бар, количество обработанных файлов);
- удобный просмотр результатов (галерея, сетка изображений с увеличением);
- возможность настройки порога уверенности детекции.

Пользователь должен выполнить полный цикл анализа без обращения к документации.

---

### 4. Надёжность

Система должна устойчиво работать при типичных ошибках.

Требования:
- корректная обработка повреждённых или нестандартных форматов изображений;
- продолжение работы при ошибке обработки отдельного файла;
- сохранение промежуточных результатов при прерывании процесса;
- отсутствие утечек памяти при обработке больших пакетов.

Среднее время безотказной работы — не менее 24 часов непрерывной эксплуатации.

---

### 5. Безопасность

Система должна обеспечивать защиту загружаемых данных.

Основные меры:
- локальная обработка изображений без передачи во внешние сервисы;
- валидация типов файлов для предотвращения загрузки вредоносного кода;
- удаление исходных изображений после завершения обработки (опционально);
- контроль доступа к сохранённым результатам.

При необходимости сетевого развёртывания предусмотреть аутентификацию и шифрование соединений (TLS).

# 4. Архитектура приложения

### 1. Концепция

Пользователь загружает через веб-интерфейс архив или набор тепловизионных снимков. Бэкенд принимает файлы, запускает пакетную обработку (нормализация → детекция → фильтрация → визуализация), сохраняет результаты в папку задачи и возвращает фронтенду список обработанных изображений с метаданными. Постоянная БД не требуется: метаданные задачи хранятся в JSON-файле внутри папки задачи.
![[Pasted image 20251031173006.png]]
---

### 2. Компоненты

**Frontend (отдельный контейнер):**
- Загрузка архива или набора изображений с отображением прогресса.
- Галерея результатов: миниатюры изображений с обнаруженными людьми, возможность увеличения и просмотра координат детекций.
- Фильтрация результатов по уровню уверенности.
- Скачивание обработанных изображений и отчёта в CSV/JSON.

Технологии: React + Vite (или Next.js), Tailwind CSS для стилизации, Axios для запросов к API.

**Backend (отдельный контейнер):**
- REST API: приём файлов, создание задачи, получение статуса, выдача результатов.
- Обработчик изображений (воркер) в отдельном процессе/потоке для асинхронной обработки.
- Файловое хранилище задач:
  - `/jobs/<job_id>/input/` — загруженные изображения
  - `/jobs/<job_id>/output/` — изображения с детекциями
  - `/jobs/<job_id>/manifest.json` — метаданные (статус, параметры, прогресс)
  - `/jobs/<job_id>/detections.json` — координаты и уверенность детекций

Технологии: Python + FastAPI; очередь задач — in-memory или multiprocessing.Queue; контейнеризация — Docker Compose.

---

### 3. Потоки данных и форматы

**manifest.json:**
```json
{
  "job_id": "uuid",
  "status": "queued|processing|completed|failed",
  "total_images": 150,
  "processed_images": 150,
  "images_with_detections": 47,
  "created_at": "timestamp",
  "completed_at": "timestamp",
  "parameters": {
    "confidence_threshold": 0.5,
    "input_format": "png",
    "model_version": "yolov8n-thermal"
  }
}
```

**detections.json:**
```json
[
  {
    "filename": "thermal_001.png",
    "detections": [
      {
        "bbox": [120, 80, 200, 240],
        "confidence": 0.87,
        "class": "person"
      }
    ]
  }
]
```

**output/**: изображения с наложенными рамками или масками (в том же формате, что и входные).

---

### 4. Нефункциональные акценты

- **Размеры и форматы:** ограничение на размер архива (до 500 МБ), поддержка ZIP/TAR; валидация типов файлов (TIFF, PNG, JPEG).
- **Ретенция:** автоматическое удаление папок `/jobs/*` старше 7 дней или при превышении 5 ГБ.
- **Безопасность:** CORS-политика, валидация MIME-типов, ограничение частоты запросов (rate limiting).
- **Масштабирование:** при увеличении нагрузки — запуск нескольких воркеров или использование объектного хранилища (S3/MinIO) для изображений.

---

### 5. Преимущества  архитектуры без бд

- Результаты обработки детерминированы и самодостаточны в папке задачи.
- Метаданные хранятся в структурированных JSON-файлах, легко читаемых и переносимых.
- Упрощённая разработка и развёртывание для учебного проекта.


# 5. Архитектура интеллектуальной системы

### Цель и контекст

Приложение выполняет пакетную обработку тепловизионных изображений: для каждого снимка определяется наличие людей, вычисляются координаты их расположения, результаты визуализируются и сохраняются. Система предназначена для работы с одноканальными термограммами, где основной информативный признак — температурный контраст между телом человека и окружающей средой.

### 1. Специфика тепловизионных данных

Термоснимки отличаются от RGB-изображений по нескольким параметрам:

| Параметр                  | RGB-изображения                 | Тепловизионные изображения                                |
| :------------------------ | :------------------------------ | :-------------------------------------------------------- |
| **Количество каналов**    | 3 (R, G, B)                     | 1 (интенсивность ИК-излучения)                            |
| **Информативный признак** | Отражённый свет, текстура, цвет | Температурный контраст                                    |
| **Освещение**             | Критично                        | Не требуется (собственное излучение)                      |
| **Разрешение**            | До 8K и выше                    | Обычно 320×240 до 640×480                                 |
| **Шумы**                  | Фотонный шум, сжатие            | Калибровочные артефакты, температурный дрейф сенсора      |
| **Маскировка объектов**   | Камуфляж, тени                  | Теплоизолирующие материалы, низкий температурный контраст |

Эти особенности требуют адаптации алгоритмов детекции: прямое применение моделей, обученных на RGB-датасетах (COCO, ImageNet).

---

### 2. Сравнение подходов к детекции на термоснимках
Обоснование находится на https://pjreddie.com/darknet/yolo/ - официальная документация от одного из разработчиков yolo

| **Подход**                                                            | **Механизм**                                                                                   | **Преимущества**                                                           | **Недостатки**                                                                                                                   |
| :-------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------- |
| **Классические методы (пороговая сегментация, HOG)**                  | Выделение областей с высокой температурой, анализ гистограмм ориентированных градиентов.       | Простота реализации, низкие вычислительные требования.                     | Высокая чувствительность к фону, плохая устойчивость к частичным окклюзиям, требуется ручная настройка порогов для каждой сцены. |
| **CNN-детекторы общего назначения (YOLO, Faster R-CNN на RGB-весах)** | Использование стандартных архитектур без адаптации к термограммам.                             | Доступность предобученных моделей, быстрая интеграция.                     | Низкая точность (mAP < 0.4) из-за различия в признаках RGB и термоданных.                                                        |
| **Адаптированные CNN (YOLO на термодатасетах, ThermalDet)**           | Дообучение или тренировка с нуля на размеченных термоснимках (FLIR ADAS, KAIST Multispectral). | Высокая точность (mAP 0.7–0.85), устойчивость к низкому контрасту и шумам. | Требуется доступ к специализированным датасетам, дополнительное время на обучение.                                               |
| **Мультиспектральные модели (RGB + Thermal fusion)**                  | Объединение признаков из RGB и термоканалов для повышения точности.                            | Максимальная точность (mAP > 0.9) в условиях хорошей видимости.            | Требуется синхронизированная RGB-камера, сложная калибровка, избыточно для задачи с чистыми термоснимками.                       |
![[Pasted image 20251031173401.png]]
**Вывод:** Для задачи обработки исключительно тепловизионных данных оптимальным является подход с **адаптированными CNN-детекторами** (например, YOLO, дообученная на термодатасете). Это обеспечивает баланс между точностью, доступностью реализации и вычислительными требованиями.

---

### 3. Обоснование выбора детекционного подхода

#### Почему CNN, а не классические методы?

Современные исследования (например, Liu et al., 2016; Krišto et al., 2020) показывают, что CNN-детекторы превосходят классические методы по всем ключевым метрикам:

| Метрика                     | HOG + SVM | Пороговая сегментация | YOLO (адаптированная)      |
| :-------------------------- | :-------- | :-------------------- | :------------------------- |
| **Precision**               | 0.65      | 0.50                  | 0.82                       |
| **Recall**                  | 0.58      | 0.45                  | 0.79                       |
| **F1-Score**                | 0.61      | 0.47                  | 0.80                       |
| **FPS (на CPU)**            | 15–20     | 30+                   | 8–12                       |
| **Устойчивость к шумам**    | Низкая    | Очень низкая          | Высокая                    |
| **Необходимость настройки** | Высокая   | Очень высокая         | Низкая (transfer learning) |

CNN обучаются извлекать иерархические признаки из данных, что критично для термоснимков с вариативным фоном и окклюзиями.

---

### 4. Выбор конкретной архитектуры: YOLO для тепловизионной детекции

**YOLO (You Only Look Once)** — семейство одноступенчатых детекторов, обеспечивающих баланс скорости и точности. Преимущества YOLO для термоснимков:

1. **Доступность предобученных весов:** YOLOv5/v8 имеют официальные реализации с документацией и готовыми чекпойнтами.
2. **Transfer learning:** модель, обученная на RGB-данных, может быть дообучена на небольшом термодатасете (~1000 изображений) за несколько часов на GPU.
3. **Эффективность на CPU:** облегчённые версии (YOLOv8n) работают на CPU с приемлемой скоростью (8–12 FPS при 640×480).
4. **Гибкость:** поддержка одноканальных входов (grayscale) без изменения архитектуры.

#### Сравнение версий YOLO для термодетекции

| Модель | Параметры | mAP@50 (FLIR ADAS) | Скорость (CPU, 640px) | Примечание |
|:---|:---|:---|:---|:---|
| YOLOv5n | ~2.5 M | 0.71 | ~85 ms/img | Лёгкая, подходит для CPU |
| YOLOv5s | ~9 M | 0.78 | ~130 ms/img | Баланс точности и скорости |
| YOLOv8n | ~3 M | 0.73 | ~90 ms/img | Улучшенная архитектура |
| YOLOv8s | ~11 M | 0.82 | ~140 ms/img | Рекомендуется для продакшена |

Для учебного проекта оптимален **YOLOv8n** или **YOLOv8s** с дообучением на термодатасете (например, FLIR ADAS или собственных данных).

---

### 5. Практическая применимость

#### Доступные термодатасеты для обучения:
- **FLIR ADAS Dataset** — 10 000+ размеченных термоснимков дорожных сцен.
- **KAIST Multispectral Pedestrian Dataset** — синхронизированные RGB + Thermal данные.
- **OSU Thermal Pedestrian Dataset** — термоснимки пешеходов в различных условиях.

#### Инженерные решения на базе YOLO:
- Системы наблюдения периметров (Hikvision, Dahua) используют адаптированные YOLO-модели.
- Военные дроны (DJI Matrice с тепловизором) применяют CNN-детекторы для обнаружения людей.
- Поисково-спасательные операции (FLIR Boson + Edge AI) используют облегчённые YOLO для работы на встраиваемых устройствах.

---

### 6. Соответствие требованиям проекта

| Требование | Реализация через YOLO |
|:---|:---|
| Обработка пакетов изображений | Батч-инференс (до 8–16 изображений одновременно) ускоряет обработку. |
| Работа на CPU | YOLOv8n обеспечивает ~100–150 мс на изображение 640×480. |
| Визуализация детекций | Встроенные утилиты (ultralytics) генерируют изображения с рамками. |
| Минимальная разметка | Transfer learning требует лишь 500–1000 аннотированных термоснимков. |
| Отсутствие GPU | Возможна работа на CPU, хотя и медленнее. |

---

**Вывод:**  
Адаптированные CNN-детекторы на основе YOLO — оптимальное решение для детекции людей на тепловизионных снимках. Они обеспечивают:
- высокую точность (mAP > 0.7) при работе с термограммами;
- приемлемую скорость обработки на CPU;
- возможность дообучения на специализированных данных;
- готовые инструменты для интеграции (библиотека ultralytics).

Поэтому ядром интеллектуальной системы выбрана модель **YOLOv8**, дообученная на термодатасете (FLIR ADAS или аналогичном).

# 6. Выбор технологий разработки

### 1. Принципы выбора

Выбор технологий основан на объективных критериях:

1. **Соответствие задаче** — возможность обрабатывать изображения пакетно, применять модели глубокого обучения и визуализировать результаты.
2. **Поддержка термоданных** — наличие библиотек для работы с TIFF, нормализации одноканальных изображений.
3. **Доступность моделей** — готовые предобученные веса для тепловизионной детекции или возможность transfer learning.
4. **Простота развёртывания** — минимальные требования к инфраструктуре (работа на CPU, без сложных зависимостей).
5. **Открытость и сообщество** — активная поддержка, документация, примеры использования.

Исходя из этих требований, выбран стек **Python + FastAPI (backend)** и **React + Tailwind CSS (frontend)**.

---

### 2. Обоснование выбора Backend-технологий

| Технология | Альтернатива | Обоснование |
|:---|:---|:---|
| **Python 3.11 + FastAPI** | Node.js (Express), Go (Gin) | Python — стандарт для задач компьютерного зрения и глубокого обучения. FastAPI обеспечивает асинхронную обработку, автогенерацию документации и высокую производительность (до 40 тыс req/s). Node.js не имеет нативной поддержки NumPy/PyTorch, Go требует C-биндингов для работы с моделями. |
| **PyTorch + Ultralytics YOLOv8** | TensorFlow (Object Detection API), OpenVINO | PyTorch — основа большинства современных CNN. Ultralytics YOLOv8 имеет встроенную поддержку transfer learning и экспорт в ONNX для ускорения. TensorFlow требует больше памяти, OpenVINO ориентирован на Intel-процессоры и усложняет кроссплатформенность. |
| **OpenCV + Pillow** | scikit-image, ImageMagick | OpenCV оптимизирован для обработки изображений в реальном времени, Pillow поддерживает широкий спектр форматов (включая 16-bit TIFF термограмм). scikit-image медленнее, ImageMagick требует внешнего процесса. |
| **NumPy + Matplotlib** | Pandas, Plotly | NumPy — базовая библиотека для матричных операций, Matplotlib генерирует статичные визуализации (PNG/JPEG). Pandas избыточен для простых структур данных, Plotly требует JS-рендеринга. |
| **JSON / CSV** | PostgreSQL, MongoDB | Для пакетной обработки БД избыточна. JSON обеспечивает читаемость и лёгкую интеграцию с фронтендом. |

> **Вывод:** Python + FastAPI + YOLO — минимально достаточный и профессиональный стек для систем обработки тепловизионных изображений. Он используется в индустриальных продуктах (FLIR AI SDK, Intel OpenVINO Thermal Toolkit) и обеспечивает баланс точности, скорости и простоты.

---

### 3. Обоснование выбора Frontend-технологий

| Технология | Альтернатива | Обоснование |
|:---|:---|:---|
| **React + Vite** | Angular, Vue, Svelte | React имеет обширную экосистему UI-библиотек. Vite обеспечивает мгновенную пересборку (Hot Module Replacement). Angular избыточен для простого интерфейса, Vue и Svelte менее распространены в enterprise. |
| **Tailwind CSS** | Bootstrap, Material UI | Tailwind позволяет быстро собрать кастомный адаптивный дизайн без лишних зависимостей. Bootstrap устарел по стилистике, Material UI тяжёлый. |
| **React Image Gallery** | Lightbox.js, PhotoSwipe | Готовый компонент для отображения галереи изображений с увеличением. Легко интегрируется с React-экосистемой. |
| **Axios** | Fetch API, GraphQL | Axios предоставляет удобные интерсепторы для обработки ошибок и прогресса загрузки. Fetch API требует больше boilerplate-кода, GraphQL избыточен. |

> **Вывод:** React + Tailwind CSS обеспечивает современный, отзывчивый интерфейс, совместимый со всеми браузерами. Этот стек используется в аналитических панелях (Grafana UI, Metabase).

---

### 4. Сравнение технологических стеков

Рассмотрены три типовых стека для систем обработки изображений:

| Критерий | Python + FastAPI / React + Tailwind | Node.js / Express / Vue.js | C++ / Qt / OpenCV |
|:---|:---|:---|:---|
| **Средняя скорость инференса (1 изображение 640×480)** | ~120 мс (YOLOv8n CPU) | N/A (требуется Python-мост) | ~80 мс (оптимизированный C++) |
| **Порог входа в разработку** | Низкий | Средний | Высокий |
| **Интеграция с нейронными сетями** | Прямая (PyTorch, ONNX) | Через внешний API или Python subprocess | Через libtorch (сложная сборка) |
| **Потребление памяти (пакет из 100 изображений)** | 300–500 МБ | 400–600 МБ | 200–300 МБ |
| **Поддержка термоформатов (TIFF 16-bit)** | Да (Pillow, OpenCV) | Частичная (через sharp, но медленнее) | Да (OpenCV, libtiff) |
| **Скорость разработки MVP** | 2–3 дня | 3–4 дня | 7–10 дней |
| **Кроссплатформенность** | Высокая (Docker) | Высокая | Средняя (требуется компиляция под каждую ОС) |
| **Документация и сообщество** | Очень активное | Активное | Среднее |

---

#### Анализ результатов

- **Python + FastAPI / React + Tailwind** обеспечивает лучшее сочетание скорости разработки, поддержки ML-инструментов и кроссплатформенности.
- **Node.js / Express** подходит для веб-части, но требует вызова Python-скриптов для обработки изображений, что усложняет архитектуру.
- **C++ / Qt** даёт максимальную производительность, но порог входа слишком высок для учебного проекта, а прирост скорости (~30–40%) не критичен для пакетной обработки.

---

### 5. Заключение

Стек **Python (FastAPI, PyTorch, OpenCV)** + **React (Tailwind CSS, Axios)** объективно удовлетворяет всем требованиям:

- **Доказанная эффективность** в коммерческих системах тепловизионной аналитики.
- **Доступность** — установка за 10 минут, работа на стандартном ноутбуке.
- **Баланс точности и скорости** — YOLOv8n обеспечивает mAP > 0.7 при 8–12 FPS на CPU.
- **Модульность** — независимые фронтенд и бэкенд с REST API.
- **Масштабируемость** — легко добавить БД, GPU-обработку или облачное хранилище.

Выбранные технологии обеспечивают оптимальное сочетание функциональности, устойчивости и трудозатрат для учебного и прикладного применения.

---

### 
